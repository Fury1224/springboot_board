<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
	
	<!--질문-->	
	<h2 class="border-bottom py-2" th:text="${question.subject}"></h2>
	<div class="card my-3">
		<div class="card-body">
			<div class="card-text" th:utext="${@commonUtil.markdown(question.content)}"></div>
			<div class="d-flex justify-content-end"> <!--우측 정렬 배치-->
				<div class="badge bg-light text-dark p-2 text-start"> <!--뱃지 형식으로, 배경색, 글자색, 전체 패딩, 텍스트 좌측 정렬-->
					<div class="mb-2"><span th:if="${question.author != null}" th:text="${question.author.username}"></span></div>
					<div th:text="${#temporals.format(question.createDate, 'yyyy-MM-dd HH:mm:ss')}"></div>
				</div>
			</div>
			<div class="my-3">
				<a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
					th:data-uri="@{|/question/vote/${question.id}|}">
					추천
					<span class="badge rounded-pill bg-success" th:text="${#lists.size(question.voter)}"></span>
				</a>
			</div>
		</div>
	</div>
	
	<!--답변 개수 / 아래 테두리 선, 상하 마진, 상하 패딩-->
	<h5 class="border-bottom my-3 py-2" th:text="|${#lists.size(question.answerList)}개의 답변이 있습니다.|"></h5>
	
	
	<!--답변 반복-->
	<div class="card my-3" th:each="answer : ${question.answerList}">
		<a th:id="|answer_${answer.id}|"></a>
		<div class="card-body">
			<div class="my-3">
				<a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
					th:data-uri="@{|/question/vote/${answer.id}|}">
					추천
					<span class="badge rounded-pill bg-success" th:text="${#lists.size(answer.voter)}"></span>
				</a>
			</div>

			<div class="card-text" th:utext="${@commonUtil.markdown(answer.content)}"></div>		
			<div class="d-flex justify-content-end"> <!--우측 정렬 배치-->
				<div class="badge bg-light text-dark p-2 text-start"> <!--뱃지 형식으로, 배경색, 글자색, 전체 패딩, 텍스트 좌측 정렬-->
					<div class="mb-2"><span th:if="${answer.author != null}" th:text="${answer.author.username}"></span></div>
					<div th:text="${#temporals.format(answer.createDate, 'yyyy-MM-dd HH:mm:ss')}"></div>
				</div>
			</div>
		</div>
	</div>

			
	<!--답변 작성-->
	<form th:action="@{|/answer/create/${question.id}|}" th:object="${answerForm}"| method="post" class="my-3">
		<div th:replace="~{form_errors :: formErrorsFragment}"></div>		
		
		<!--로그인 안됐으면 비활성화, 됐으면 활성화-->
		<textarea sec:authorize="isAnonymous()" disabled th:field="*{content}" rows="10" class="form-control"></textarea>
		<textarea sec:authorize="isAuthenticated()" th:field="*{content}" rows="10" class="form-control"></textarea>
		
		<input class="btn btn-outline-danger my-2" type="submit" value="답변 등록">
	</form>

</div>

<script layout:fragment="script" type="text/javascript">
const recommend_elements = document.getElementsByClassName ("recommend")
	Array.from(recommend_elements).forEach(function(element) {
		element.addEventListener('click', function() {
			if(confirm("정말로 추천하시겠습니까?")) {
				location.href = this.dataset.uri;
			};
		});
	});
</script>
</html>